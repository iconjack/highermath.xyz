<!DOCTYPE html>
<html>
<head>
<title>Ken's Tetrahedron Circuit Puzzle</title>
<style>
    * {
        margin: 0;
        padding: 0;
    }
    body {
        background-color: white;;
    }
</style>
</head>
<body>
<canvas id='canvas' width=1000 height=1000></canvas>
<script>

let canvas = document.getElementById('canvas');
let ctx = canvas.getContext('2d');

let straws = [0,1,1,1,0,0];
let leds = Array(4);

let buttons = [
    {label:'A', key:'A', straws:[[0,1,2]]},
    {label:'B', key:'B', straws:[[0,1,2]]},
    {label:'C', key:'C', straws:[[0,1,2]]},
    {label:'D', key:'D', straws:[[0,1,2]]},
]

let pairs = [[0,1],[0,2],[0,3],[1,2],[1,3],[2,3]];

function dot(x,y) {
    ctx.save();
    ctx.translate(x,y);
    ctx.beginPath();

    ctx.fillStyle = 'black';
    ctx.shadowColor = 'black';
    ctx.ellipse(0, 0, 10, 10, Math.PI/4, 0, 2*Math.PI);
    ctx.fill();
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 0.3;
    ctx.stroke();

    ctx.restore();
}

function dirty() {
    // requestAnimationFrame(draw);
}

class LED {
    constructor(color, size) {
        this.color = color;
        this.size = size;
        this.state = 0;
    }

    on() {
        this.state = 1;
    }

    off() {
        this.state = 0;
    }


    draw() {
        console.log(this.state);
        ctx.save();
        ctx.beginPath();

        ctx.fillStyle = this.color;
        ctx.shadowColor = this.color;
        ctx.shadowBlur = 10;
        ctx.ellipse(0, 0, this.size, this.size, Math.PI/4, 0, 2*Math.PI);
        if (this.state == 1) {  
            ctx.fill();
        }
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 0.3;
        ctx.stroke();

        ctx.restore();
    }
}

class LEDPair {
    constructor() {
        this.leds = [new LED('red', 8), new LED('green', 8)];
        this.value(Math.floor(Math.random()*4));
    }

    value(n) {
        if (n & 1 == 1) {
            this.leds[0].on();
        } else {
            this.leds[0].off();
        }
        
        if ((n >> 1) & 1 == 1) {
            this.leds[1].on();
        } else {
            this.leds[1].off();
        }
    }

    draw() {
        ctx.save();
        ctx.translate(15, 20);
        this.leds[1].draw();
        ctx.translate(15, 20);
        this.leds[0].draw();
        ctx.restore();
    }
}

class Button {
    constructor(label, key, action) {
        this.label = label;
        this.key = key;
        this.action = action;
    }

    draw(x, y) {
        ctx.save();
        ctx.restore();
    }
}

class Site {
    constructor(key, neighbors) {
        this.label = label;
        this.key = key;
        this.neighbors = neighbors;
        // this.led0 = new LED('green', 12);
        this.pair = new LEDPair();
        this.button = new Button();

    }

    hit() {
        console.log(this.label);
    }

    draw() {
        ctx.save();
        this.pair.draw();
        ctx.restore();
    }
}


function label(c, dx, dy) {
    ctx.fillText(c, dx, dy);
}


class Tetra {
    constructor() {
        this.sites = [new Site('A', []),
                      new Site('B', []),
                      new Site('C', []),
                      new Site('D', [])];
        this.locations = [[200, 100], [100,200], [300,200], [200,300]];
    }

    draw() {
        let labels = ['A', 'B', 'C', 'D'];
        let labelx = [10, -26, +42, 10];
        let labely = [-10, +22, 24, +82];
        for (let i = 0; i < this.sites.length; i++) {
            ctx.save();
            ctx.translate(this.locations[i][0], this.locations[i][1]);
            ctx.font = '28px serif';
            label(labels[i], labelx[i], labely[i]);

            this.sites[i].draw()
            ctx.restore();
        }
    }
}

this.addEventListener("keydown", event => {
    let key = event.key.toUpperCase();
    switch (key) {
        case 'A':
            tetra.sites[0].hit();
            dirty();
            break;
        case 'B':
            tetra.sites[1].hit();
            dirty();
            break;
        case 'C':
            tetra.sites[2].hit();
            dirty();
            break;
        case 'D':
            tetra.sites[3].hit();
            dirty();
            break;
        default:
            console.log('errant key:  ' + event.key);
    } 
});

let tetra = new Tetra();
tetra.draw();

</script>
    
</body>
</html>
